<% html_title('Project tracking with EVM') %>
<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'issue_evm',               :plugin => 'redmine_issue_evm' %>
  <%= javascript_include_tag 'drawchart',            :plugin => 'redmine_issue_evm' %>
  <%= javascript_include_tag 'highcharts.js',        :plugin => 'redmine_issue_evm' %>
  <%= javascript_include_tag '../../../javascripts/select_list_move', :plugin => 'redmine_issue_evm' %>
  <script>
    function disableobject( object, ischecked ) {
      document.getElementById(object).disabled = ischecked;
    }
  </script>
<% end %>
<!-- Basline setting -->
<div class="contextual">
  <%= link_to l(:label_baseline_set), {controller:"evmbaselines", action:"index", id: @project.id} ,:class => 'icon icon-edit'%>
</div>
<!--Header-->
<h2 id="evm-title"><%=l(:title_evm_tab)%></h2>
<% if @no_data %>
  <p class="nodata"><%= l(:label_no_data) %></p>
<% else %>
  <!-- Option -->
  <%= form_tag url_for(action: :index), method: :get, id: 'query_form' do %>
    <fieldset id="filters" class="collapsible collapsed">
      <legend onclick="toggleFieldset(this);"><%= l(:label_options) %></legend>
      <div style="display: none;">
        <%= render :partial => '/evms/view_option',
            :locals => { basis_date: @basis_date,
                         no_use_baseline: @no_use_baseline,
                         evmbaseline: @evmbaseline,
                         baseline_id: @baseline_id,
                         forecast: @forecast,
                         display_version: @display_version,
                         display_performance: @display_performance,
                         calcetc: @calcetc,
                         display_explanation: @display_explanation  } %>
      </div>
    </fieldset>
    <p>
      <!-- Apply button -->
      <%= link_to "#", {:onclick => "$(this).closest('form').submit()",:class => 'icon icon-checked' } do l(:button_apply) end %>
    </p>
  <% end %>
  <!--Indicator value-->
  <h3><%= l(:subtitle_evm_summary)%></h3>
  <div id="evm-suummary-wrapper">
    <%= render :partial => '/evms/measure',
        :locals => { project_evm: @project_evm } %>
  </div>
  <!--Charts-->
  <h3><%= l(:subtitle_evm_graph_main) %></h3>
  <div id="evm-charts-wrapper">
    <!-- Main Chart -->
    <div id="evm-graph-lines" class="evm-chart">
      <%= render :partial => '/evms/project_chart_js',
          :locals => { basis_date: @basis_date,
                       project_evm: @project_evm,
                       project_name: project_chart_name } %>
    </div>
    <!-- Incomplete issue list -->
    <fieldset id="issuelist" class="collapsible collapsed">
      <legend onclick="toggleFieldset(this);"><%= l(:subtitle_evm_incomplete_issues) %></legend>
      <div style="display: none;">
        <%= render :partial => '/evms/incomplete_issue_list',
            :locals => { incomplete_issues: @incomplete_issues } %>
      </div>
    </fieldset>
    <br>
    <br>
    <!-- Performance Chart -->
    <% if @display_performance %>
      <h3><%= l(:subtitle_evm_graph_performance) %></h3>
      <div id="evm-graph-lines-performance" class="evm-chart">
        <%= render :partial => '/evms/performance_chart_js',
            :locals => { basis_date: @basis_date,
                         project_evm: @project_evm,
                         project_name: project_chart_name } %>
      </div>
    <% end %>
    <!-- version Chart -->
    <% if @display_version %>
      <% unless @project.versions.blank? %>
        <h3><%= l(:subtitle_evm_graph_version) %></h3>
        <% @project.versions.each do |version| %>
          <% unless @version_evm[version.id].nil? %>
            <div id="evm-graph-lines-version-<%= version.id %>" class="evm-chart-<%= version.id %>"</div>
            <%= render :partial => '/evms/version_chart_js',
              :locals => { basis_date: @basis_date,
                           version_evm: @version_evm[version.id],
                           version: version,
                           version_name: version_chart_name(version) } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% end %>
<!--Sidebar-->
<% if @display_explanation %>
  <% content_for :sidebar do %>
    <%= render :partial => '/evms/explanation' %>
  <% end %>
<% end %>
